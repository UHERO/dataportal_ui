<div class="transform-checks">
  <label *ngIf="portalSettings.transformations.yoy" class="form-check-inline">
    <input type="checkbox" (change)="yoyActive($event)" [checked]="yoyChecked">Year/Year
  </label>
  <label *ngIf="portalSettings.transformations.ytd" class="form-check-inline">
    <input type="checkbox" (change)="ytdActive($event)" [checked]="ytdChecked">Year-to-Date
  </label>
  <label *ngIf="portalSettings.transformations.c5ma" class="form-check-inline">
    <input type="checkbox" (change)="c5maActive($event)" [checked]="c5maChecked">Annual Change
  </label>
</div>
<app-category-datatables *ngIf="series && series.length" [portalSettings]="portalSettings" [yoy]="yoyChecked" [ytd]="ytdChecked" [c5ma]="c5maChecked" [categoryDates]="tableDates"
  [analyzerSeries]="series" [analyzer]="true" [tableId]="'analyzer-table'"></app-category-datatables>
<div class="analyzer-table">
  <div class="table-row">
    <div class="table" #tableScroll>
      <table *ngIf="series && series.length">
        <tr>
          <th class="empty-header">&nbsp;</th>
          <ng-template ngFor let-date [ngForOf]="tableDates" let-i="index">
            <td>
              <b>{{date.tableDate}}</b>
            </td>
          </ng-template>
        </tr>
        <ng-template ngFor let-serie [ngForOf]="series" let-i="index">
          <tr>
            <th title="{{serie.seriesDetail.title}}">
              <i class="material-icons analyze-button remove-button" title="Remove from Analyzer" (click)="updateAnalyze(serie)">&#xE872;</i>
              <i class="material-icons analyze-chart color{{serie.seriesDetail.id}}" (click)="updateChart(serie)">{{ serie.showInChart ? '&#xE834;' : '&#xE835;'}}</i>
              <a *ngIf="serie.seriesDetail.geography" [routerLink]="['/series']" [queryParams]="{ id: serie.seriesDetail.id, sa: serie.saParam }" (click)="hideInfo(serie.seriesDetail.id)">
                {{serie.displayName}}
              </a>
              <a tabindex="0" id="{{serie.seriesDetail.id}}" class="info" (click)="showPopover(serie.seriesDetail)" role="button" data-animation='false' data-toggle="popover">
                <i class="material-icons info-icon">&#xE88F;</i>
              </a>
            </th>
            <ng-template ngFor let-item [ngForOf]="serie.analyzerTableDisplay.lvlCategoryTable">
              <td>{{item.formattedValue}}</td>
            </ng-template>
          </tr>
          <tr *ngIf="yoyChecked">
            <th>
              {{(serie.percent) ? '&emsp; YOY (ch.)' : '&emsp; YOY (%)'}}
            </th>
            <ng-template ngFor let-item [ngForOf]="serie.analyzerTableDisplay.pc1CategoryTable">
              <td>{{item.formattedValue}}</td>
            </ng-template>
          </tr>
          <tr *ngIf="c5maChecked">
            <th>
              {{(serie.percent)? '&emsp; Annual (ch.)' : '&emsp; Annual (%)'}}
            </th>
            <ng-template ngFor let-item [ngForOf]="serie.analyzerTableDisplay.c5maCategoryTable">
              <td>{{item.formattedValue}}</td>
            </ng-template>
          </tr>
          <tr *ngIf="ytdChecked">
            <th>
              {{(serie.percent)? '&emsp; YTD (ch.)' : '&emsp; YTD (%)'}}
            </th>
            <ng-template ngFor let-item [ngForOf]="serie.analyzerTableDisplay.ytdCategoryTable">
              <td>{{item.formattedValue}}</td>
            </ng-template>
          </tr>
        </ng-template>
      </table>
    </div>
  </div>
</div>
<div class="analyzer-table">
  <div class="table-row">
    <div class="table">
      <table>
        <tr>
          <th class="empty-header">&nbsp;</th>
          <td>Minimum Value</td>
          <td>Maximum Value</td>
          <td>% Change</td>
          <td>Change</td>
          <td>Total</td>
          <td>Avg</td>
          <td>Compound Annual Growth Rate</td>
        </tr>
        <ng-template ngFor let-serie [ngForOf]="series">
          <tr *ngIf="serie.summaryStats">
            <th class="series-title" title="{{serie.title}}">
              <i class="material-icons analyze-button remove-button" title="Remove from Analyzer" (click)="updateAnalyze(serie)">&#xE872;</i>
              <i class="material-icons analyze-chart color{{serie.seriesDetail.id}}" (click)="updateChart(serie)">{{ serie.showInChart ? '&#xE834;' : '&#xE835;'}}</i>
              <a [routerLink]="['/series']" [queryParams]="{ id: serie.seriesDetail.id, sa: serie.saParam }" queryParamsHandling='merge'>
                {{serie.displayName}}
              </a>
            </th>
            <td>{{serie.summaryStats.minValue + ' ' + serie.summaryStats.minValueDate }}</td>
            <td>{{serie.summaryStats.maxValue + ' ' + serie.summaryStats.maxValueDate }}</td>
            <td>{{!serie.seriesDetail.percent ? serie.summaryStats.percChange : '&nbsp;'}}</td>
            <td>{{serie.summaryStats.levelChange}}</td>
            <td>{{serie.summaryStats.total}}</td>
            <td>{{serie.summaryStats.avg}}</td>
            <td>{{serie.summaryStats.cagr}}</td>
          </tr>
        </ng-template>
      </table>
    </div>
    <p *ngIf="missingSummaryStat" class="stat-warning"><i class="material-icons text-danger">&#xE001;</i> The following series contain N/As due to missing values included in the selected range: 
      <ng-template ngFor let-serie [ngForOf]="series">
        <ul>
          <li *ngIf="serie.summaryStats && serie.summaryStats.missing">{{serie.displayName}}</li>
        </ul>
      </ng-template>  
    </p>
  </div>
</div>