<div class="multi-series-container">
	<ng-template ngFor let-data [ngForOf]="categoryData | async">
		<h2 class="selected-category" [class.search-term]="search" id="id_top">{{data.selectedCategory}}</h2>
		<p *ngIf="search && data.invalid">No results found for "{{data.invalid}}."</p>
		<p *ngIf="!search && data.invalid">{{data.invalid}}</p>
		<i *ngIf="search && !data.requestComplete && !data.invalid" class="fas fa-spinner fa-pulse fa-fw"></i>
		<ng-template ngFor let-sub [ngForOf]="data.subcategories" let-i="index">
			<ng-template ngIf [ngIf]="search || (dataListId ? sub.id == dataListId : sub.id == data.defaultDataList)">
				<ng-template ngIf [ngIf]="portal.categoryTabs">
					<ul class="content-links" *ngIf="data.subcategories.length > 1" [attr.id]="'id_' + sub.id">
						<li *ngFor="let sub of data.subcategories; let subInd='index'">
							<a [routerLink]="['/category']" [queryParams]="{data_list_id: sub.id}" queryParamsHandling="merge"
								[class.current-sub]="subInd === i">{{sub.name}}</a>
						</li>
					</ul>
					<hr class="sublist-separator" *ngIf="data.subcategories.length > 1">
				</ng-template>
				<ng-template ngIf [ngIf]="!portal.categoryTabs">
					<p class="category-header" *ngIf="sub.isHeader" [attr.id]="'id_' + sub.id">{{sub.name}}</p>
					<hr class="sublist-separator" *ngIf="data.subcategories.length > 1 && sub.isHeader">
					<p class="subcategory-header" *ngIf="!sub.isHeader" [attr.id]="'id_' + sub.id">{{sub.name}}</p>
				</ng-template>
				<ng-template ngIf [ngIf]="!sub.isHeader">
					<div class="filters" *ngIf="data.requestComplete">
						<app-geo-selector [regions]="data.regions" [selectedGeo]="data.currentGeo"
							(selectedGeoChange)="redrawSeriesGeo($event, data.currentFreq, sub.id)" class="selector">
						</app-geo-selector>
						<app-freq-selector [freqs]="data.frequencies" [selectedFreq]="data.currentFreq"
							(selectedFreqChange)="redrawSeriesFreq($event, data.currentGeo, sub.id)" class="selector">
						</app-freq-selector>
						<a *ngIf="routeView === 'table'" (click)="switchView(sub.id)" class="switch-view">Chart View
							<i class="material-icons md-18">show_chart</i>
						</a>
						<a *ngIf="routeView === 'chart' || !routeView" (click)="switchView(sub.id)"
							class="switch-view">Table View
							<i class="material-icons md-18">view_list</i>
						</a>
						<label *ngIf="routeView === 'table'" class="form-check-inline">
							<input type="checkbox" [checked]="queryParams.yoy === 'true'"
								(change)="yoyActive($event, sub.id)">Year/Year
						</label>
						<label *ngIf="routeView === 'table' && data.currentFreq?.freq !== 'A'"
							class="form-check-inline">
							<input type="checkbox" [checked]="queryParams.ytd === 'true'"
								(change)="ytdActive($event, sub.id)">Year-to-Date
						</label>
						<app-date-slider *ngIf="!sub.noData" class="sliders" [portalSettings]="portalSettings"
							[dates]="data.categoryDates" [sublist]="data.subcategories" [subCat]="sub"
							[dateFrom]="seriesStart ? seriesStart : null" [dateTo]="seriesEnd ? seriesEnd: null"
							[freq]="data.currentFreq?.freq" (updateRange)="changeRange($event)"></app-date-slider>
					</div>
					<i *ngIf="!data.requestComplete || !displaySeries" class="fas fa-spinner fa-pulse fa-fw"></i>
					<app-category-table-view *ngIf="routeView === 'table'"
						[portalSettings]="portalSettings" [dates]="data.categoryDates" [tableStart]="seriesStart"
						[tableEnd]="seriesEnd" [sublist]="sub" [data]="data.displaySeries" [geo]="data.currentGeo"
						[tableId]="sub.id" [freq]="data.currentFreq?.freq" [subcatIndex]="sub.id"
						[yoyActive]="queryParams.yoy === 'true'" [ytdActive]="queryParams.ytd === 'true'"
						[noSeries]="sub.noData" [params]="queryParams" [seriesInAnalyzer]="seriesInAnalyzer">
					</app-category-table-view>
					<app-category-charts *ngIf="routeView !== 'table' && displaySeries"
						[portalSettings]="portalSettings" [chartStart]="seriesStart" [chartEnd]="seriesEnd"
						[sublist]="sub" [data]="data.displaySeries" [dateWrapper]="data.categoryDateWrapper"
						[dates]="data.categoryDates" [freq]="data.currentFreq?.freq" [noSeries]="sub.noData"
						[params]="queryParams" [seriesInAnalyzer]="seriesInAnalyzer"
						(updateURLFragment)="updateRoute($event)">
					</app-category-charts>
				</ng-template>
			</ng-template>
		</ng-template>
	</ng-template>
</div>